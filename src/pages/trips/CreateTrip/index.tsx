import React, { useState, useEffect } from 'react';
import styled from 'styled-components';
import { useParams } from 'react-router-dom';
import { createTrip, getTourApiCongestionData } from '../../../auth/api';
import type { CreateTripRequest, BaseResponse, TripResponse, TourApiItem } from '../../../auth/api/interfaces';

const PageContainer = styled.div`
  padding: 32px;
  background: #f8fafc;
  min-height: 100vh;
  color: #1e293b;
`;

const PageHeader = styled.div`
  margin-bottom: 32px;
`;

const PageTitle = styled.h1`
  font-size: 28px;
  font-weight: 700;
  color: #1e293b;
  margin: 0 0 8px 0;
`;

const PageSubtitle = styled.p`
  font-size: 16px;
  color: #64748b;
  margin: 0;
`;

const FormCard = styled.div`
  background: white;
  padding: 32px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  margin-bottom: 24px;
  border: 1px solid #f1f5f9;
  position: relative;
  overflow: hidden;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
  }
`;

const CardTitle = styled.h2`
  font-size: 20px;
  font-weight: 600;
  color: #1e293b;
  margin: 0 0 24px 0;
  display: flex;
  align-items: center;
  gap: 8px;
  
  &::before {
    content: '‚úàÔ∏è';
    font-size: 18px;
  }
`;

const FormGroup = styled.div`
  margin-bottom: 20px;
  
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #374151;
    font-size: 14px;
  }
  
  input[type="text"],
  input[type="date"] {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.2s ease;
    background: #ffffff;
    
    &:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    &::placeholder {
      color: #9ca3af;
    }
  }
`;

const SubmitButton = styled.button`
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
  color: white;
  padding: 16px 24px;
  border: none;
  border-radius: 16px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  width: 100%;
  margin-top: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
  }
  
  &:active {
    transform: translateY(0);
  }
  
  &:disabled {
    background: #d1d5db;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
`;

const MessageText = styled.p<{ isError?: boolean }>`
  margin-top: 16px;
  padding: 12px 16px;
  border-radius: 8px;
  font-weight: 500;
  background: ${props => props.isError ? '#fef2f2' : '#f0fdf4'};
  color: ${props => props.isError ? '#dc2626' : '#16a34a'};
  border: 1px solid ${props => props.isError ? '#fecaca' : '#bbf7d0'};
`;

const CongestionSection = styled.div`
  background: #ffffff;
  padding: 32px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  margin-bottom: 24px;
  border: 1px solid #e2e8f0;
`;

const CongestionTitle = styled.h3`
  font-size: 20px;
  font-weight: 600;
  color: #1e293b;
  margin: 0 0 24px 0;
  display: flex;
  align-items: center;
  gap: 8px;
  
  &::before {
    content: 'üìä';
    font-size: 18px;
  }
`;

const CongestionChart = styled.div`
  display: flex;
  align-items: end;
  gap: 8px;
  height: 320px;
  margin-bottom: 24px;
  padding: 24px 24px 24px 60px;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border-radius: 16px;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
  position: relative;
  overflow: visible;
  border: 1px solid #e2e8f0;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(124, 58, 237, 0.02) 50%, transparent 70%);
    border-radius: 16px;
    pointer-events: none;
  }
`;

const BarContainer = styled.div`
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  height: 100%;
  flex: 1;
  position: relative;
`;

const YAxis = styled.div`
  position: absolute;
  left: 16px;
  top: 24px;
  bottom: 24px;
  width: 40px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: flex-end;
`;

const YAxisLabel = styled.div`
  color: #64748b;
  font-size: 12px;
  font-weight: 600;
  line-height: 1;
  transform: translateY(50%);
`;

const YAxisLine = styled.div`
  position: absolute;
  left: 0;
  right: 0;
  height: 1px;
  background: rgba(100, 116, 139, 0.2);
  pointer-events: none;
`;

const CongestionBar = styled.div<{ height: number; isSelected?: boolean; congestion: number }>`
  background: ${props => {
    if (props.isSelected) {
      return 'linear-gradient(180deg, #7c3aed 0%, #5b21b6 100%)';
    }
    if (props.congestion >= 80) {
      return 'linear-gradient(180deg, #ef4444 0%, #dc2626 100%)';
    } else if (props.congestion >= 60) {
      return 'linear-gradient(180deg, #f59e0b 0%, #d97706 100%)';
    } else if (props.congestion >= 40) {
      return 'linear-gradient(180deg, #3b82f6 0%, #2563eb 100%)';
    } else {
      return 'linear-gradient(180deg, #10b981 0%, #059669 100%)';
    }
  }};
  border-radius: 12px 12px 0 0;
  height: ${props => Math.max(props.height * 2.8, 6)}px;
  min-height: 6px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  box-shadow: ${props => props.isSelected 
    ? '0 0 20px rgba(124, 58, 237, 0.4), 0 4px 12px rgba(0, 0, 0, 0.15)' 
    : '0 2px 8px rgba(0, 0, 0, 0.1)'};
  
  &:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    z-index: 10;
  }
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
    border-radius: 12px 12px 0 0;
  }
  
  &::after {
    content: '';
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-bottom: 8px solid ${props => props.isSelected ? '#5b21b6' : 'transparent'};
    opacity: ${props => props.isSelected ? 1 : 0};
    transition: all 0.3s ease;
  }
`;

const CongestionLabel = styled.div`
  position: absolute;
  bottom: -40px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: #64748b;
  font-weight: 600;
  white-space: nowrap;
  text-align: center;
`;

const Tooltip = styled.div<{ show: boolean }>`
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: #1e293b;
  color: white;
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
  opacity: ${props => props.show ? 1 : 0};
  visibility: ${props => props.show ? 'visible' : 'hidden'};
  transition: all 0.3s ease;
  z-index: 20;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  margin-bottom: 12px;
  border: 1px solid #334155;
  
  &::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid #1e293b;
  }
`;

const RecommendationCard = styled.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 24px;
  padding: 20px;
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
  border-radius: 16px;
  border: 1px solid #bbf7d0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
`;

const RecommendationInfo = styled.div`
  display: flex;
  flex-direction: column;
  gap: 4px;
`;

const RecommendationLabel = styled.div`
  font-size: 14px;
  font-weight: 600;
  color: #166534;
`;

const RecommendationValue = styled.div`
  font-size: 18px;
  font-weight: 700;
  color: #15803d;
`;

const LoadingSpinner = styled.div`
  display: inline-block;
  width: 40px;
  height: 40px;
  border: 4px solid #e5e7eb;
  border-top: 4px solid #7c3aed;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`;

const CreateTripPage: React.FC = () => {
  const { workcationGroupId } = useParams<{ workcationGroupId: string }>();
  const [place, setPlace] = useState<string>('');
  const [startDate, setStartDate] = useState<string>('');
  const [endDate, setEndDate] = useState<string>('');
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState<string | null>(null);
  const [isError, setIsError] = useState(false);
  
  // ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ†® ÏÉÅÌÉú
  const [congestionData, setCongestionData] = useState<TourApiItem[]>([]);
  const [congestionLoading, setCongestionLoading] = useState(false);
  const [selectedDate, setSelectedDate] = useState<string>('');

  // ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (Ïã§Ï†ú TourAPI ÏÇ¨Ïö©)
  const fetchCongestionData = async (placeName: string) => {
    if (!placeName.trim()) return;
    
    try {
      setCongestionLoading(true);
      
      
      // ÌïúÍµ≠ ÌñâÏ†ïÍµ¨Ïó≠ ÏΩîÎìúÌëú Í∏∞Î∞ò ÏôÑÏ†ÑÌïú Îß§Ìïë
      const getAreaAndSignguCode = (place: string) => {
        const placeLower = place.toLowerCase();
        
        // ÏÑúÏö∏ÌäπÎ≥ÑÏãú (11)
        if (placeLower.includes('ÏÑúÏö∏') || placeLower.includes('seoul')) {
          if (placeLower.includes('Ï¢ÖÎ°ú')) return { areaCd: '11', signguCd: '11110' };
          if (placeLower.includes('Ï§ëÍµ¨')) return { areaCd: '11', signguCd: '11140' };
          if (placeLower.includes('Ïö©ÏÇ∞')) return { areaCd: '11', signguCd: '11170' };
          if (placeLower.includes('ÏÑ±Îèô')) return { areaCd: '11', signguCd: '11200' };
          if (placeLower.includes('Í¥ëÏßÑ')) return { areaCd: '11', signguCd: '11215' };
          if (placeLower.includes('ÎèôÎåÄÎ¨∏')) return { areaCd: '11', signguCd: '11230' };
          if (placeLower.includes('Ï§ëÎûë')) return { areaCd: '11', signguCd: '11260' };
          if (placeLower.includes('ÏÑ±Î∂Å')) return { areaCd: '11', signguCd: '11290' };
          if (placeLower.includes('Í∞ïÎ∂Å')) return { areaCd: '11', signguCd: '11305' };
          if (placeLower.includes('ÎèÑÎ¥â')) return { areaCd: '11', signguCd: '11320' };
          if (placeLower.includes('ÎÖ∏Ïõê')) return { areaCd: '11', signguCd: '11350' };
          if (placeLower.includes('ÏùÄÌèâ')) return { areaCd: '11', signguCd: '11380' };
          if (placeLower.includes('ÏÑúÎåÄÎ¨∏')) return { areaCd: '11', signguCd: '11410' };
          if (placeLower.includes('ÎßàÌè¨')) return { areaCd: '11', signguCd: '11440' };
          if (placeLower.includes('ÏñëÏ≤ú')) return { areaCd: '11', signguCd: '11470' };
          if (placeLower.includes('Í∞ïÏÑú')) return { areaCd: '11', signguCd: '11500' };
          if (placeLower.includes('Íµ¨Î°ú')) return { areaCd: '11', signguCd: '11530' };
          if (placeLower.includes('Í∏àÏ≤ú')) return { areaCd: '11', signguCd: '11545' };
          if (placeLower.includes('ÏòÅÎì±Ìè¨')) return { areaCd: '11', signguCd: '11560' };
          if (placeLower.includes('ÎèôÏûë')) return { areaCd: '11', signguCd: '11590' };
          if (placeLower.includes('Í¥ÄÏïÖ')) return { areaCd: '11', signguCd: '11620' };
          if (placeLower.includes('ÏÑúÏ¥à')) return { areaCd: '11', signguCd: '11650' };
          if (placeLower.includes('Í∞ïÎÇ®')) return { areaCd: '11', signguCd: '11680' };
          if (placeLower.includes('ÏÜ°Ìåå')) return { areaCd: '11', signguCd: '11710' };
          if (placeLower.includes('Í∞ïÎèô')) return { areaCd: '11', signguCd: '11740' };
          return { areaCd: '11', signguCd: '11110' }; // Í∏∞Î≥∏: Ï¢ÖÎ°úÍµ¨
        }
        
        // Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú (26)
        if (placeLower.includes('Î∂ÄÏÇ∞') || placeLower.includes('busan')) {
          if (placeLower.includes('Ï§ëÍµ¨')) return { areaCd: '26', signguCd: '26110' };
          if (placeLower.includes('ÏÑúÍµ¨')) return { areaCd: '26', signguCd: '26140' };
          if (placeLower.includes('ÎèôÍµ¨')) return { areaCd: '26', signguCd: '26170' };
          if (placeLower.includes('ÏòÅÎèÑ')) return { areaCd: '26', signguCd: '26200' };
          if (placeLower.includes('Î∂ÄÏÇ∞ÏßÑ')) return { areaCd: '26', signguCd: '26230' };
          if (placeLower.includes('ÎèôÎûò')) return { areaCd: '26', signguCd: '26260' };
          if (placeLower.includes('ÎÇ®Íµ¨')) return { areaCd: '26', signguCd: '26290' };
          if (placeLower.includes('Î∂ÅÍµ¨')) return { areaCd: '26', signguCd: '26320' };
          if (placeLower.includes('Ìï¥Ïö¥ÎåÄ')) return { areaCd: '26', signguCd: '26350' };
          if (placeLower.includes('ÏÇ¨Ìïò')) return { areaCd: '26', signguCd: '26380' };
          if (placeLower.includes('Í∏àÏ†ï')) return { areaCd: '26', signguCd: '26410' };
          if (placeLower.includes('Í∞ïÏÑú')) return { areaCd: '26', signguCd: '26440' };
          if (placeLower.includes('Ïó∞Ï†ú')) return { areaCd: '26', signguCd: '26470' };
          if (placeLower.includes('ÏàòÏòÅ')) return { areaCd: '26', signguCd: '26500' };
          if (placeLower.includes('ÏÇ¨ÏÉÅ')) return { areaCd: '26', signguCd: '26530' };
          if (placeLower.includes('Í∏∞Ïû•')) return { areaCd: '26', signguCd: '26710' };
          return { areaCd: '26', signguCd: '26110' }; // Í∏∞Î≥∏: Ï§ëÍµ¨
        }
        
        // ÎåÄÍµ¨Í¥ëÏó≠Ïãú (27)
        if (placeLower.includes('ÎåÄÍµ¨') || placeLower.includes('daegu')) {
          if (placeLower.includes('Ï§ëÍµ¨')) return { areaCd: '27', signguCd: '27110' };
          if (placeLower.includes('ÎèôÍµ¨')) return { areaCd: '27', signguCd: '27140' };
          if (placeLower.includes('ÏÑúÍµ¨')) return { areaCd: '27', signguCd: '27170' };
          if (placeLower.includes('ÎÇ®Íµ¨')) return { areaCd: '27', signguCd: '27200' };
          if (placeLower.includes('Î∂ÅÍµ¨')) return { areaCd: '27', signguCd: '27230' };
          if (placeLower.includes('ÏàòÏÑ±')) return { areaCd: '27', signguCd: '27260' };
          if (placeLower.includes('Îã¨ÏÑú')) return { areaCd: '27', signguCd: '27290' };
          if (placeLower.includes('Îã¨ÏÑ±')) return { areaCd: '27', signguCd: '27710' };
          return { areaCd: '27', signguCd: '27110' }; // Í∏∞Î≥∏: Ï§ëÍµ¨
        }
        
        // Ïù∏Ï≤úÍ¥ëÏó≠Ïãú (28)
        if (placeLower.includes('Ïù∏Ï≤ú') || placeLower.includes('incheon')) {
          if (placeLower.includes('Ï§ëÍµ¨')) return { areaCd: '28', signguCd: '28110' };
          if (placeLower.includes('ÎèôÍµ¨')) return { areaCd: '28', signguCd: '28140' };
          if (placeLower.includes('ÎØ∏Ï∂îÌôÄ')) return { areaCd: '28', signguCd: '28177' };
          if (placeLower.includes('Ïó∞Ïàò')) return { areaCd: '28', signguCd: '28185' };
          if (placeLower.includes('ÎÇ®Îèô')) return { areaCd: '28', signguCd: '28200' };
          if (placeLower.includes('Î∂ÄÌèâ')) return { areaCd: '28', signguCd: '28237' };
          if (placeLower.includes('Í≥ÑÏñë')) return { areaCd: '28', signguCd: '28245' };
          if (placeLower.includes('ÏÑúÍµ¨')) return { areaCd: '28', signguCd: '28260' };
          if (placeLower.includes('Í∞ïÌôî')) return { areaCd: '28', signguCd: '28710' };
          if (placeLower.includes('ÏòπÏßÑ')) return { areaCd: '28', signguCd: '28720' };
          return { areaCd: '28', signguCd: '28110' }; // Í∏∞Î≥∏: Ï§ëÍµ¨
        }
        
        // Í¥ëÏ£ºÍ¥ëÏó≠Ïãú (29)
        if (placeLower.includes('Í¥ëÏ£º') || placeLower.includes('gwangju')) {
          if (placeLower.includes('ÎèôÍµ¨')) return { areaCd: '29', signguCd: '29110' };
          if (placeLower.includes('ÏÑúÍµ¨')) return { areaCd: '29', signguCd: '29140' };
          if (placeLower.includes('ÎÇ®Íµ¨')) return { areaCd: '29', signguCd: '29170' };
          if (placeLower.includes('Î∂ÅÍµ¨')) return { areaCd: '29', signguCd: '29200' };
          if (placeLower.includes('Í¥ëÏÇ∞')) return { areaCd: '29', signguCd: '29230' };
          return { areaCd: '29', signguCd: '29110' }; // Í∏∞Î≥∏: ÎèôÍµ¨
        }
        
        // ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú (30)
        if (placeLower.includes('ÎåÄÏ†Ñ') || placeLower.includes('daejeon')) {
          if (placeLower.includes('ÎèôÍµ¨')) return { areaCd: '30', signguCd: '30110' };
          if (placeLower.includes('Ï§ëÍµ¨')) return { areaCd: '30', signguCd: '30140' };
          if (placeLower.includes('ÏÑúÍµ¨')) return { areaCd: '30', signguCd: '30170' };
          if (placeLower.includes('Ïú†ÏÑ±')) return { areaCd: '30', signguCd: '30200' };
          if (placeLower.includes('ÎåÄÎçï')) return { areaCd: '30', signguCd: '30230' };
          return { areaCd: '30', signguCd: '30110' }; // Í∏∞Î≥∏: ÎèôÍµ¨
        }
        
        // Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú (31)
        if (placeLower.includes('Ïö∏ÏÇ∞') || placeLower.includes('ulsan')) {
          if (placeLower.includes('Ï§ëÍµ¨')) return { areaCd: '31', signguCd: '31110' };
          if (placeLower.includes('ÎÇ®Íµ¨')) return { areaCd: '31', signguCd: '31140' };
          if (placeLower.includes('ÎèôÍµ¨')) return { areaCd: '31', signguCd: '31170' };
          if (placeLower.includes('Î∂ÅÍµ¨')) return { areaCd: '31', signguCd: '31200' };
          if (placeLower.includes('Ïö∏Ï£º')) return { areaCd: '31', signguCd: '31710' };
          return { areaCd: '31', signguCd: '31110' }; // Í∏∞Î≥∏: Ï§ëÍµ¨
        }
        
        // ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú (36)
        if (placeLower.includes('ÏÑ∏Ï¢Ö') || placeLower.includes('sejong')) {
          return { areaCd: '36', signguCd: '36010' };
        }
        
        // Í≤ΩÍ∏∞ÎèÑ (41)
        if (placeLower.includes('Í≤ΩÍ∏∞') || placeLower.includes('gyeonggi')) {
          if (placeLower.includes('ÏàòÏõê')) return { areaCd: '41', signguCd: '41111' };
          if (placeLower.includes('ÏÑ±ÎÇ®')) return { areaCd: '41', signguCd: '41131' };
          if (placeLower.includes('ÏùòÏ†ïÎ∂Ä')) return { areaCd: '41', signguCd: '41150' };
          if (placeLower.includes('ÏïàÏñë')) return { areaCd: '41', signguCd: '41171' };
          if (placeLower.includes('Î∂ÄÏ≤ú')) return { areaCd: '41', signguCd: '41190' };
          if (placeLower.includes('Í¥ëÎ™Ö')) return { areaCd: '41', signguCd: '41210' };
          if (placeLower.includes('ÌèâÌÉù')) return { areaCd: '41', signguCd: '41220' };
          if (placeLower.includes('Í≥ºÏ≤ú')) return { areaCd: '41', signguCd: '41250' };
          if (placeLower.includes('Ïò§ÏÇ∞')) return { areaCd: '41', signguCd: '41271' };
          if (placeLower.includes('ÏãúÌù•')) return { areaCd: '41', signguCd: '41290' };
          if (placeLower.includes('Íµ∞Ìè¨')) return { areaCd: '41', signguCd: '41310' };
          if (placeLower.includes('ÏùòÏôï')) return { areaCd: '41', signguCd: '41330' };
          if (placeLower.includes('ÌïòÎÇ®')) return { areaCd: '41', signguCd: '41350' };
          if (placeLower.includes('Ïö©Ïù∏')) return { areaCd: '41', signguCd: '41461' };
          if (placeLower.includes('ÌååÏ£º')) return { areaCd: '41', signguCd: '41480' };
          if (placeLower.includes('Ïù¥Ï≤ú')) return { areaCd: '41', signguCd: '41500' };
          if (placeLower.includes('ÏïàÏÑ±')) return { areaCd: '41', signguCd: '41550' };
          if (placeLower.includes('ÍπÄÌè¨')) return { areaCd: '41', signguCd: '41570' };
          if (placeLower.includes('ÌôîÏÑ±')) return { areaCd: '41', signguCd: '41590' };
          if (placeLower.includes('Í¥ëÏ£º')) return { areaCd: '41', signguCd: '41610' };
          if (placeLower.includes('Ïó¨Ï£º')) return { areaCd: '41', signguCd: '41630' };
          if (placeLower.includes('ÏñëÌèâ')) return { areaCd: '41', signguCd: '41830' };
          if (placeLower.includes('Í≥†Ïñë')) return { areaCd: '41', signguCd: '41281' };
          if (placeLower.includes('ÎèôÎëêÏ≤ú')) return { areaCd: '41', signguCd: '41250' };
          if (placeLower.includes('Í∞ÄÌèâ')) return { areaCd: '41', signguCd: '41820' };
          if (placeLower.includes('Ïó∞Ï≤ú')) return { areaCd: '41', signguCd: '41800' };
          return { areaCd: '41', signguCd: '41111' }; // Í∏∞Î≥∏: ÏàòÏõêÏãú
        }
        
        // Ï∂©Ï≤≠Î∂ÅÎèÑ (43)
        if (placeLower.includes('Ï∂©Î∂Å') || placeLower.includes('chungbuk')) {
          if (placeLower.includes('Ï≤≠Ï£º')) return { areaCd: '43', signguCd: '43111' };
          if (placeLower.includes('Ï∂©Ï£º')) return { areaCd: '43', signguCd: '43130' };
          if (placeLower.includes('Ï†úÏ≤ú')) return { areaCd: '43', signguCd: '43150' };
          if (placeLower.includes('Î≥¥ÏùÄ')) return { areaCd: '43', signguCd: '43720' };
          if (placeLower.includes('Ïò•Ï≤ú')) return { areaCd: '43', signguCd: '43730' };
          if (placeLower.includes('ÏòÅÎèô')) return { areaCd: '43', signguCd: '43740' };
          if (placeLower.includes('Ï¶ùÌèâ')) return { areaCd: '43', signguCd: '43745' };
          if (placeLower.includes('ÏßÑÏ≤ú')) return { areaCd: '43', signguCd: '43750' };
          if (placeLower.includes('Í¥¥ÏÇ∞')) return { areaCd: '43', signguCd: '43760' };
          if (placeLower.includes('ÏùåÏÑ±')) return { areaCd: '43', signguCd: '43770' };
          if (placeLower.includes('Îã®Ïñë')) return { areaCd: '43', signguCd: '43800' };
          return { areaCd: '43', signguCd: '43111' }; // Í∏∞Î≥∏: Ï≤≠Ï£ºÏãú
        }
        
        // Ï∂©Ï≤≠ÎÇ®ÎèÑ (44)
        if (placeLower.includes('Ï∂©ÎÇ®') || placeLower.includes('chungnam')) {
          if (placeLower.includes('Ï≤úÏïà')) return { areaCd: '44', signguCd: '44131' };
          if (placeLower.includes('Í≥µÏ£º')) return { areaCd: '44', signguCd: '44150' };
          if (placeLower.includes('Î≥¥Î†π')) return { areaCd: '44', signguCd: '44180' };
          if (placeLower.includes('ÏïÑÏÇ∞')) return { areaCd: '44', signguCd: '44200' };
          if (placeLower.includes('ÏÑúÏÇ∞')) return { areaCd: '44', signguCd: '44210' };
          if (placeLower.includes('ÎÖºÏÇ∞')) return { areaCd: '44', signguCd: '44230' };
          if (placeLower.includes('Í≥ÑÎ£°')) return { areaCd: '44', signguCd: '44250' };
          if (placeLower.includes('ÎãπÏßÑ')) return { areaCd: '44', signguCd: '44270' };
          if (placeLower.includes('Í∏àÏÇ∞')) return { areaCd: '44', signguCd: '44710' };
          if (placeLower.includes('Î∂ÄÏó¨')) return { areaCd: '44', signguCd: '44760' };
          if (placeLower.includes('ÏÑúÏ≤ú')) return { areaCd: '44', signguCd: '44770' };
          if (placeLower.includes('Ï≤≠Ïñë')) return { areaCd: '44', signguCd: '44790' };
          if (placeLower.includes('ÌôçÏÑ±')) return { areaCd: '44', signguCd: '44800' };
          if (placeLower.includes('ÏòàÏÇ∞')) return { areaCd: '44', signguCd: '44810' };
          if (placeLower.includes('ÌÉúÏïà')) return { areaCd: '44', signguCd: '44825' };
          return { areaCd: '44', signguCd: '44131' }; // Í∏∞Î≥∏: Ï≤úÏïàÏãú
        }
        
        // Ï†ÑÎùºÎ∂ÅÎèÑ (45)
        if (placeLower.includes('Ï†ÑÎ∂Å') || placeLower.includes('jeonbuk')) {
          if (placeLower.includes('Ï†ÑÏ£º')) return { areaCd: '45', signguCd: '45111' };
          if (placeLower.includes('Íµ∞ÏÇ∞')) return { areaCd: '45', signguCd: '45130' };
          if (placeLower.includes('ÏùµÏÇ∞')) return { areaCd: '45', signguCd: '45140' };
          if (placeLower.includes('Ï†ïÏùç')) return { areaCd: '45', signguCd: '45180' };
          if (placeLower.includes('ÎÇ®Ïõê')) return { areaCd: '45', signguCd: '45190' };
          if (placeLower.includes('ÍπÄÏ†ú')) return { areaCd: '45', signguCd: '45210' };
          if (placeLower.includes('ÏôÑÏ£º')) return { areaCd: '45', signguCd: '45710' };
          if (placeLower.includes('ÏßÑÏïà')) return { areaCd: '45', signguCd: '45720' };
          if (placeLower.includes('Î¨¥Ï£º')) return { areaCd: '45', signguCd: '45730' };
          if (placeLower.includes('Ïû•Ïàò')) return { areaCd: '45', signguCd: '45740' };
          if (placeLower.includes('ÏûÑÏã§')) return { areaCd: '45', signguCd: '45750' };
          if (placeLower.includes('ÏàúÏ∞Ω')) return { areaCd: '45', signguCd: '45770' };
          if (placeLower.includes('Í≥†Ï∞Ω')) return { areaCd: '45', signguCd: '45790' };
          if (placeLower.includes('Î∂ÄÏïà')) return { areaCd: '45', signguCd: '45800' };
          return { areaCd: '45', signguCd: '45111' }; // Í∏∞Î≥∏: Ï†ÑÏ£ºÏãú
        }
        
        // Ï†ÑÎùºÎÇ®ÎèÑ (46)
        if (placeLower.includes('Ï†ÑÎÇ®') || placeLower.includes('jeonnam')) {
          if (placeLower.includes('Î™©Ìè¨')) return { areaCd: '46', signguCd: '46110' };
          if (placeLower.includes('Ïó¨Ïàò')) return { areaCd: '46', signguCd: '46130' };
          if (placeLower.includes('ÏàúÏ≤ú')) return { areaCd: '46', signguCd: '46150' };
          if (placeLower.includes('ÎÇòÏ£º')) return { areaCd: '46', signguCd: '46170' };
          if (placeLower.includes('Í¥ëÏñë')) return { areaCd: '46', signguCd: '46230' };
          if (placeLower.includes('Îã¥Ïñë')) return { areaCd: '46', signguCd: '46710' };
          if (placeLower.includes('Í≥°ÏÑ±')) return { areaCd: '46', signguCd: '46720' };
          if (placeLower.includes('Íµ¨Î°Ä')) return { areaCd: '46', signguCd: '46730' };
          if (placeLower.includes('Í≥†Ìù•')) return { areaCd: '46', signguCd: '46770' };
          if (placeLower.includes('Î≥¥ÏÑ±')) return { areaCd: '46', signguCd: '46780' };
          if (placeLower.includes('ÌôîÏàú')) return { areaCd: '46', signguCd: '46790' };
          if (placeLower.includes('Ïû•Ìù•')) return { areaCd: '46', signguCd: '46800' };
          if (placeLower.includes('Í∞ïÏßÑ')) return { areaCd: '46', signguCd: '46810' };
          if (placeLower.includes('Ìï¥ÎÇ®')) return { areaCd: '46', signguCd: '46820' };
          if (placeLower.includes('ÏòÅÏïî')) return { areaCd: '46', signguCd: '46830' };
          if (placeLower.includes('Î¨¥Ïïà')) return { areaCd: '46', signguCd: '46840' };
          if (placeLower.includes('Ìï®Ìèâ')) return { areaCd: '46', signguCd: '46860' };
          if (placeLower.includes('ÏòÅÍ¥ë')) return { areaCd: '46', signguCd: '46870' };
          if (placeLower.includes('Ïû•ÏÑ±')) return { areaCd: '46', signguCd: '46880' };
          if (placeLower.includes('ÏôÑÎèÑ')) return { areaCd: '46', signguCd: '46890' };
          if (placeLower.includes('ÏßÑÎèÑ')) return { areaCd: '46', signguCd: '46900' };
          if (placeLower.includes('Ïã†Ïïà')) return { areaCd: '46', signguCd: '46910' };
          return { areaCd: '46', signguCd: '46110' }; // Í∏∞Î≥∏: Î™©Ìè¨Ïãú
        }
        
        // Í≤ΩÏÉÅÎ∂ÅÎèÑ (47)
        if (placeLower.includes('Í≤ΩÎ∂Å') || placeLower.includes('gyeongbuk')) {
          if (placeLower.includes('Ìè¨Ìï≠')) return { areaCd: '47', signguCd: '47111' };
          if (placeLower.includes('Í≤ΩÏ£º')) return { areaCd: '47', signguCd: '47130' };
          if (placeLower.includes('ÍπÄÏ≤ú')) return { areaCd: '47', signguCd: '47150' };
          if (placeLower.includes('ÏïàÎèô')) return { areaCd: '47', signguCd: '47170' };
          if (placeLower.includes('Íµ¨ÎØ∏')) return { areaCd: '47', signguCd: '47190' };
          if (placeLower.includes('ÏòÅÏ£º')) return { areaCd: '47', signguCd: '47210' };
          if (placeLower.includes('ÏòÅÏ≤ú')) return { areaCd: '47', signguCd: '47230' };
          if (placeLower.includes('ÏÉÅÏ£º')) return { areaCd: '47', signguCd: '47250' };
          if (placeLower.includes('Î¨∏Í≤Ω')) return { areaCd: '47', signguCd: '47280' };
          if (placeLower.includes('Í≤ΩÏÇ∞')) return { areaCd: '47', signguCd: '47290' };
          if (placeLower.includes('Íµ∞ÏúÑ')) return { areaCd: '47', signguCd: '47720' };
          if (placeLower.includes('ÏùòÏÑ±')) return { areaCd: '47', signguCd: '47730' };
          if (placeLower.includes('Ï≤≠ÏÜ°')) return { areaCd: '47', signguCd: '47750' };
          if (placeLower.includes('ÏòÅÏñë')) return { areaCd: '47', signguCd: '47760' };
          if (placeLower.includes('ÏòÅÎçï')) return { areaCd: '47', signguCd: '47770' };
          if (placeLower.includes('Ï≤≠ÎèÑ')) return { areaCd: '47', signguCd: '47820' };
          if (placeLower.includes('Í≥†Î†π')) return { areaCd: '47', signguCd: '47830' };
          if (placeLower.includes('ÏÑ±Ï£º')) return { areaCd: '47', signguCd: '47840' };
          if (placeLower.includes('Ïπ†Í≥°')) return { areaCd: '47', signguCd: '47850' };
          if (placeLower.includes('ÏòàÏ≤ú')) return { areaCd: '47', signguCd: '47900' };
          if (placeLower.includes('Î¥âÌôî')) return { areaCd: '47', signguCd: '47920' };
          if (placeLower.includes('Ïö∏ÏßÑ')) return { areaCd: '47', signguCd: '47930' };
          if (placeLower.includes('Ïö∏Î¶â')) return { areaCd: '47', signguCd: '47940' };
          return { areaCd: '47', signguCd: '47111' }; // Í∏∞Î≥∏: Ìè¨Ìï≠Ïãú
        }
        
        // Í≤ΩÏÉÅÎÇ®ÎèÑ (48)
        if (placeLower.includes('Í≤ΩÎÇ®') || placeLower.includes('gyeongnam')) {
          if (placeLower.includes('Ï∞ΩÏõê')) return { areaCd: '48', signguCd: '48121' };
          if (placeLower.includes('ÏßÑÏ£º')) return { areaCd: '48', signguCd: '48170' };
          if (placeLower.includes('ÌÜµÏòÅ')) return { areaCd: '48', signguCd: '48220' };
          if (placeLower.includes('ÏÇ¨Ï≤ú')) return { areaCd: '48', signguCd: '48240' };
          if (placeLower.includes('ÍπÄÌï¥')) return { areaCd: '48', signguCd: '48250' };
          if (placeLower.includes('Î∞ÄÏñë')) return { areaCd: '48', signguCd: '48270' };
          if (placeLower.includes('Í±∞Ï†ú')) return { areaCd: '48', signguCd: '48310' };
          if (placeLower.includes('ÏñëÏÇ∞')) return { areaCd: '48', signguCd: '48330' };
          if (placeLower.includes('ÏùòÎ†π')) return { areaCd: '48', signguCd: '48720' };
          if (placeLower.includes('Ìï®Ïïà')) return { areaCd: '48', signguCd: '48730' };
          if (placeLower.includes('Ï∞ΩÎÖï')) return { areaCd: '48', signguCd: '48740' };
          if (placeLower.includes('Í≥†ÏÑ±')) return { areaCd: '48', signguCd: '48820' };
          if (placeLower.includes('ÎÇ®Ìï¥')) return { areaCd: '48', signguCd: '48840' };
          if (placeLower.includes('ÌïòÎèô')) return { areaCd: '48', signguCd: '48850' };
          if (placeLower.includes('ÏÇ∞Ï≤≠')) return { areaCd: '48', signguCd: '48860' };
          if (placeLower.includes('Ìï®Ïñë')) return { areaCd: '48', signguCd: '48870' };
          if (placeLower.includes('Í±∞Ï∞Ω')) return { areaCd: '48', signguCd: '48880' };
          if (placeLower.includes('Ìï©Ï≤ú')) return { areaCd: '48', signguCd: '48890' };
          return { areaCd: '48', signguCd: '48121' }; // Í∏∞Î≥∏: Ï∞ΩÏõêÏãú
        }
        
        // Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ (50)
        if (placeLower.includes('Ï†úÏ£º') || placeLower.includes('jeju')) {
          if (placeLower.includes('ÏÑúÍ∑ÄÌè¨')) return { areaCd: '50', signguCd: '50130' };
          return { areaCd: '50', signguCd: '50110' }; // Í∏∞Î≥∏: Ï†úÏ£ºÏãú
        }
        
        // Í∞ïÏõêÌäπÎ≥ÑÏûêÏπòÎèÑ (51)
        if (placeLower.includes('Í∞ïÏõê') || placeLower.includes('gangwon')) {
          if (placeLower.includes('Ï∂òÏ≤ú')) return { areaCd: '51', signguCd: '51110' };
          if (placeLower.includes('ÏõêÏ£º')) return { areaCd: '51', signguCd: '51130' };
          if (placeLower.includes('Í∞ïÎ¶â')) return { areaCd: '51', signguCd: '51150' };
          if (placeLower.includes('ÎèôÌï¥')) return { areaCd: '51', signguCd: '51170' };
          if (placeLower.includes('ÌÉúÎ∞±')) return { areaCd: '51', signguCd: '51190' };
          if (placeLower.includes('ÏÜçÏ¥à')) return { areaCd: '51', signguCd: '51210' };
          if (placeLower.includes('ÏÇºÏ≤ô')) return { areaCd: '51', signguCd: '51230' };
          if (placeLower.includes('ÌôçÏ≤ú')) return { areaCd: '51', signguCd: '51720' };
          if (placeLower.includes('Ìö°ÏÑ±')) return { areaCd: '51', signguCd: '51730' };
          if (placeLower.includes('ÏòÅÏõî')) return { areaCd: '51', signguCd: '51750' };
          if (placeLower.includes('ÌèâÏ∞Ω')) return { areaCd: '51', signguCd: '51760' };
          if (placeLower.includes('Ï†ïÏÑ†')) return { areaCd: '51', signguCd: '51770' };
          if (placeLower.includes('Ï≤†Ïõê')) return { areaCd: '51', signguCd: '51780' };
          if (placeLower.includes('ÌôîÏ≤ú')) return { areaCd: '51', signguCd: '51790' };
          if (placeLower.includes('ÏñëÍµ¨')) return { areaCd: '51', signguCd: '51800' };
          if (placeLower.includes('Ïù∏Ï†ú')) return { areaCd: '51', signguCd: '51810' };
          if (placeLower.includes('Í≥†ÏÑ±')) return { areaCd: '51', signguCd: '51820' };
          if (placeLower.includes('ÏñëÏñë')) return { areaCd: '51', signguCd: '51830' };
          return { areaCd: '51', signguCd: '51110' }; // Í∏∞Î≥∏: Ï∂òÏ≤úÏãú
        }
        
        // Ï†ÑÎ∂ÅÌäπÎ≥ÑÏûêÏπòÎèÑ (52)
        if (placeLower.includes('Ï†ÑÎ∂ÅÌäπÎ≥Ñ') || placeLower.includes('jeonbuk special')) {
          return { areaCd: '52', signguCd: '52110' };
        }
        
        // Í∏∞Î≥∏Í∞í: Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ Ï†úÏ£ºÏãú
        return { areaCd: '50', signguCd: '50110' };
      };
      
      const { areaCd, signguCd } = getAreaAndSignguCode(placeName);
      
      console.log('TourAPI Ìò∏Ï∂ú:', { areaCd, signguCd });
      
      const response = await getTourApiCongestionData({
        areaCd: areaCd,
        signguCd: signguCd,
        numOfRows: 30
      });
      
      console.log('TourAPI ÏùëÎãµ:', response);
      
      if (response.response.body.items && response.response.body.items.item && response.response.body.items.item.length > 0) {
        setCongestionData(response.response.body.items.item);
        // Í∞ÄÏû• ÌòºÏû°ÎèÑÍ∞Ä ÎÇÆÏùÄ ÎÇ† Ï∞æÍ∏∞
        const bestDay = response.response.body.items.item.reduce((min: TourApiItem, current: TourApiItem) => 
          parseFloat(current.cnctrRate) < parseFloat(min.cnctrRate) ? current : min
        );
        setSelectedDate(bestDay.baseYmd);
      } else {
        // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ Îπà Î∞∞Ïó¥Î°ú ÏÑ§Ï†ï
        setCongestionData([]);
        console.log('ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ Í¥ÄÍ¥ëÏßÄÎ™ÖÏùÑ ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.');
      }
    } catch (error) {
      console.error('ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ïã§Ìå®:', error);
      setCongestionData([]);
    } finally {
      setCongestionLoading(false);
    }
  };

  // Ïû•ÏÜå ÏûÖÎ†•Ïù¥ Î≥ÄÍ≤ΩÎê† Îïå ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
  useEffect(() => {
    if (place.trim()) {
      const timeoutId = setTimeout(() => {
        fetchCongestionData(place);
      }, 1000); // 1Ï¥à ÌõÑ API Ìò∏Ï∂ú (ÎîîÎ∞îÏö¥Ïã±)
      
      return () => clearTimeout(timeoutId);
    }
  }, [place]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!workcationGroupId) {
      setMessage('ÏõåÏºÄÏù¥ÏÖò Í∑∏Î£π IDÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.');
      setIsError(true);
      return;
    }
    if (!place || !startDate || !endDate) {
      setMessage('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      setIsError(true);
      return;
    }

    const data: CreateTripRequest = {
      place,
      start_date: startDate,
      end_date: endDate,
    };

    try {
      setLoading(true);
      setMessage(null);
      setIsError(false);
      const response: BaseResponse<TripResponse> = await createTrip(parseInt(workcationGroupId, 10), data);
      console.log('Trip ÏÉùÏÑ± ÏùëÎãµ:', response);
      console.log('response.data:', response.data);
      console.log('response.data Ï°¥Ïû¨ Ïó¨Î∂Ä:', !!response.data);
      
      if (response.data) {
        const successMessage = `Trip '${response.data.trip_id}'Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.`;
        console.log('ÏÑ±Í≥µ Î©îÏãúÏßÄ ÏÑ§Ï†ï:', successMessage);
        setMessage(successMessage);
        setIsError(false);
        // Ìèº Ï¥àÍ∏∞Ìôî (ÏÑ±Í≥µ Ïãú)
        setPlace('');
        setStartDate('');
        setEndDate('');
      } else {
        const errorMessage = response.message || 'Trip ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
        console.log('Ïã§Ìå® Î©îÏãúÏßÄ ÏÑ§Ï†ï:', errorMessage);
        setMessage(errorMessage);
        setIsError(true);
      }
    } catch (error: any) {
      console.error('Error creating trip:', error);
      // 500 Ïò§Î•òÏóê ÎåÄÌïú Îçî Î™ÖÌôïÌïú Î©îÏãúÏßÄ Ï†úÍ≥µ
      if (error.response?.status === 500) {
        setMessage('ÏÑúÎ≤Ñ ÎÇ¥Î∂Ä Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
      } else if (error.response?.status === 404) {
        setMessage('Trip ÏÉùÏÑ± APIÍ∞Ä ÏïÑÏßÅ Íµ¨ÌòÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
      } else {
        setMessage('Trip ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
      }
      setIsError(true);
    } finally {
      setLoading(false);
    }
  };

  // ÌòºÏû°ÎèÑ Ï∞®Ìä∏ Î†åÎçîÎßÅ
  const renderCongestionChart = () => {
    if (congestionLoading) {
      return (
        <div style={{ textAlign: 'center', padding: '60px 20px' }}>
          <LoadingSpinner />
          <p style={{ marginTop: '20px', color: '#64748b', fontSize: '16px', fontWeight: '500' }}>
            ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...
          </p>
        </div>
      );
    }
    
    if (congestionData.length === 0) {
      return (
        <div style={{ textAlign: 'center', padding: '60px 20px' }}>
          <div style={{ 
            fontSize: '48px', 
            marginBottom: '16px',
            opacity: 0.5
          }}>üìä</div>
          <p style={{ color: '#64748b', marginBottom: '12px', fontSize: '16px', fontWeight: '500' }}>
            ÌòºÏû°ÎèÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§
          </p>
          <p style={{ fontSize: '14px', color: '#94a3b8', lineHeight: '1.5' }}>
            üí° ÌåÅ: ÏßÄÏó≠Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Î≥¥ÏÑ∏Ïöî<br/>
            Ïòà: "ÏÑúÏö∏", "Î∂ÄÏÇ∞", "Ï†úÏ£ºÎèÑ", "Í≤ΩÏ£º", "Í∞ïÏõêÎèÑ" Îì±
          </p>
        </div>
      );
    }

    const bestDay = congestionData.reduce((min, current) => 
      parseFloat(current.cnctrRate) < parseFloat(min.cnctrRate) ? current : min
    );

    return (
      <>
        <CongestionChart>
          {/* YÏ∂ï ÎààÍ∏à */}
          <YAxis>
            <YAxisLabel>100%</YAxisLabel>
            <YAxisLine style={{ top: '20px' }} />
            <YAxisLabel>75%</YAxisLabel>
            <YAxisLine style={{ top: '25%' }} />
            <YAxisLabel>50%</YAxisLabel>
            <YAxisLine style={{ top: '50%' }} />
            <YAxisLabel>25%</YAxisLabel>
            <YAxisLine style={{ top: '75%' }} />
            <YAxisLabel>0%</YAxisLabel>
          </YAxis>
          
          {congestionData.slice(0, 14).map((item, index) => {
            const congestion = parseFloat(item.cnctrRate);
            const height = congestion; // 0~100% Ï†àÎåÄ Í∏∞Ï§ÄÏúºÎ°ú ÎÜíÏù¥ ÏÑ§Ï†ï
            const isSelected = item.baseYmd === selectedDate;
            const date = new Date(item.baseYmd);
            const dayName = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][date.getDay()];
            
            return (
              <BarContainer key={index}>
                <CongestionBar
                  height={height}
                  isSelected={isSelected}
                  congestion={congestion}
                  onClick={() => setSelectedDate(item.baseYmd)}
                />
                <CongestionLabel>
                  {item.baseYmd.split('-')[2]}<br/>
                  <span style={{ fontSize: '9px', opacity: 0.8 }}>({dayName})</span>
                </CongestionLabel>
                <Tooltip show={isSelected}>
                  {item.baseYmd}<br/>
                  ÌòºÏû°ÎèÑ: {congestion.toFixed(1)}%
                </Tooltip>
              </BarContainer>
            );
          })}
        </CongestionChart>
        
        <RecommendationCard>
          <RecommendationInfo>
            <RecommendationLabel>üéØ Ï∂îÏ≤ú ÎÇ†Ïßú</RecommendationLabel>
            <RecommendationValue>{bestDay.baseYmd}</RecommendationValue>
          </RecommendationInfo>
          <RecommendationInfo style={{ textAlign: 'right' }}>
            <RecommendationLabel>ÌòºÏû°ÎèÑ</RecommendationLabel>
            <RecommendationValue>{bestDay.cnctrRate}%</RecommendationValue>
          </RecommendationInfo>
        </RecommendationCard>
      </>
    );
  };

  return (
    <PageContainer>
      <PageHeader>
        <PageTitle>Trip ÏÉùÏÑ±</PageTitle>
        <PageSubtitle>ÏõåÏºÄÏù¥ÏÖò Í∑∏Î£π ID: {workcationGroupId}</PageSubtitle>
      </PageHeader>
      
      <FormCard>
        <CardTitle>Trip Ï†ïÎ≥¥ ÏûÖÎ†•</CardTitle>
        <form onSubmit={handleSubmit}>
          <FormGroup>
            <label htmlFor="place">Î™©Ï†ÅÏßÄ</label>
            <input
              id="place"
              type="text"
              value={place}
              onChange={(e) => setPlace(e.target.value)}
              disabled={loading}
              placeholder="Ïòà: Ï†úÏ£ºÎèÑ, ÏÑúÏö∏, Î∂ÄÏÇ∞"
            />
          </FormGroup>
          <FormGroup>
            <label htmlFor="startDate">ÏãúÏûëÏùº</label>
            <input
              id="startDate"
              type="date"
              value={startDate}
              onChange={(e) => setStartDate(e.target.value)}
              disabled={loading}
            />
          </FormGroup>
          <FormGroup>
            <label htmlFor="endDate">Ï¢ÖÎ£åÏùº</label>
            <input
              id="endDate"
              type="date"
              value={endDate}
              onChange={(e) => setEndDate(e.target.value)}
              disabled={loading}
            />
          </FormGroup>
          <SubmitButton type="submit" disabled={loading}>
            {loading ? 'ÏÉùÏÑ± Ï§ë...' : 'Trip ÏÉùÏÑ±ÌïòÍ∏∞'}
          </SubmitButton>
          {message && <MessageText isError={isError}>{message}</MessageText>}
        </form>
      </FormCard>
      
      {/* ÌòºÏû°ÎèÑ ÏòàÏ∏° ÏÑπÏÖò */}
      {place && (
        <CongestionSection>
          <CongestionTitle>{place} ÌòºÏû°ÎèÑ ÏòàÏ∏° (Ìñ•ÌõÑ 14Ïùº)</CongestionTitle>
          {renderCongestionChart()}
        </CongestionSection>
      )}
    </PageContainer>
  );
};

export default CreateTripPage;
